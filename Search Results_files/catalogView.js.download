(()=>{var t,e;ck.setCookie=function(t,e,a){var i="";if("number"==typeof a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3),i="expires="+n.toUTCString()}document.cookie=t+"="+e+"; "+i+"; path=/"},ck.getCookie=function(t){for(var e=t+"=",a=document.cookie.split(";"),i=0;i<a.length;i++){for(var n=a[i];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(e))return n.substring(e.length,n.length)}return""},ck.addUrlParam=function(t,e,a,i){i=!!i;var n=new RegExp("(\\?|\\&)"+e+"=.*?(?=(&|$))"),o="",r="";return-1!==t.indexOf("#")&&(o=t.split("#"),t=o[0],r=o[1]),n.test(t)?t=t.replace(n,"$1"+e+"="+a):/\?.+$/.test(t)?t+=i?encodeURIComponent("&"+e+"="+a):"&"+e+"="+a:(t+="?"+e+"=",t+=i?encodeURIComponent(a):a),""!==r&&(t+="#"+r),t},$((function(){$(document).on("touchend click",".showGalleryView",(function(){$("body").removeClass("textOnlyList"),$("body").addClass("listShowCart listShowDetails"),$(".expandAllCards").removeClass("toggled"),$(".zoomedWrapper").removeClass("zoomedWrapper").find(".cardLink").removeClass("zoomed").find(".catalogItemMag").remove(".catalogItemMag"),$(".zoomItem").removeClass("zoomItem");var t=window.location.href;t=ck.addUrlParam(t,"view","gallery"),document.location=t,ck.setCookie("viewType","listShowCart listShowDetails",365)})),$(document).on("touchend click",".showDetailView",(function(){$("body").removeClass("listShowCart listShowDetails textOnlyList"),$(".expandAllCards").removeClass("toggled"),$(".zoomedWrapper").removeClass("zoomedWrapper").find(".cardLink").removeClass("zoomed").find(".catalogItemMag").remove(".catalogItemMag"),ck.setCookie("viewType","",365);var t=window.location.href;t=ck.addUrlParam(t,"view","detail"),document.location=t})),$(document).on("touchend click",".showTextView",(function(){$("body").removeClass("listShowCart listShowDetails"),$(".expandAllCards").removeClass("toggled"),$(".zoomedWrapper").removeClass("zoomedWrapper").find(".cardLink").removeClass("zoomed").find(".catalogItemMag").remove(".catalogItemMag"),$(".zoomItem").removeClass("zoomItem"),$("body").addClass("textOnlyList"),ck.setCookie("viewType","textOnlyList",365);var t=window.location.href;t=ck.addUrlParam(t,"view","text"),document.location=t}))})),(()=>{var t=t||{};$((function(){t.trackSettingByCookie(".perPage","limit"),t.trackSettingByCookie("#sortBy","sortBy")})),t.trackSettingByCookie=function(e,a){$(document).on("change",e,(function(){var e=$(this).val(),i=a+"="+e+";path=/",n=window.location.href;document.cookie=i,n=t.removeUrlParam(n,"page"),window.location.href=n}))},t.removeUrlParam=function(t,e){var a=t.split("?");if(a.length>=2){for(var i=a.shift(),n=a.join("?"),o=encodeURIComponent(e)+"=",r=n.split(/[&;]/g),s=r.length;s-- >0;)-1!==r[s].lastIndexOf(o,0)&&r.splice(s,1);t=r.length>0?i+"?"+r.join("&"):i}return t},t.addUrlParam=function(t,e,a,i){i=!!i;var n=new RegExp("(\\?|\\&)"+e+"=.*?(?=(&|$))"),o="",r="";return-1!==t.indexOf("#")&&(o=t.split("#"),t=o[0],r=o[1]),n.test(t)?t=t.replace(n,"$1"+e+"="+a):/\?.+$/.test(t)?t+=i?encodeURIComponent("&"+e+"="+a):"&"+e+"="+a:(t+="?"+e+"=",t+=i?encodeURIComponent(a):a),""!==r&&(t+="#"+r),t}})(),$((function(){var t={cardStyles:["NM","EX","VG","G"]};window.ckCatalog=window.ckCatalog||{},$(document).on("touchend click",".cardTypeList > li:not(.active)",(function(){var e=_.intersection(this.classList,t.cardStyles);e.length>0&&(e="."+e[0]);var a=$(this).parent(),i=a.siblings(".addToCartByType");i.find(".active").removeClass("active"),i.find(e).addClass("active"),a.find("li.active").removeClass("active"),a.find(e).addClass("active")})),$(document).on("show.bs.dropdown",".addToCartForm .dropdown",(function(t){var e=$(t.relatedTarget).parents(".addToCartForm"),a=parseInt(e.find("input[name=qty]").val());if(e.find(".picked").removeClass("picked"),a>=0){var i="li:nth-child("+(a+1)+")";e.find(i).addClass("picked")}})),$(document).on("touchend click",".addToCartForm .qtyList > li",(function(e){var a=parseInt($(this).text());isNaN(a)&&(a=0),t.updateSelectedQty(this,a)})),$(document).on("click",".addToCartForm:not(.maxxed) .addOneButton, .addToCartForm:not(.maxxed) .addItemToCart",(function(){var e=parseInt($(this).parents("form").find(".qty").val())||0;e++,t.updateSelectedQty(this,e)})),$(document).on("click",".addToCartFormBulk .addItemToCartBulk",(function(){t.processBulkInput(this)})),$(document).on("keydown",".addToCartFormBulk .qty",(function(e){13==e.keyCode&&(e.preventDefault(),t.processBulkInput(this))})),t.processBulkInput=function(e){var a=parseInt($(e).parents("form").find(".qty").val())||0,i=parseInt($(e).parents("form").find(".maxQty").val())||0;if($(e).parents("form").find(".warning").remove(),a>i){var n='<div class="warning">Max quantity is '+i+".</div>";$(e).parents("form").append(n)}else t.updateSelectedQty(e,a)},$(document).on("click",".removeAll",(function(){t.updateSelectedQty(this,0)})),$(document).on("cartUpdated.ck",(function(e){var a=window.ckCatalog.cart(),i=a.items;t.populateFormQty(a),Object.keys(i).forEach((function(t){var e="."+t;if($(e).length>0){var a=i[t].qty||0,n=parseInt($(e).find("input[name=maxQty]").val());$(e).find("input[name=qty]").val(a),a>=n&&$(e).addClass("maxxed")}}))})),t.cartSet=_.debounce((function(e){t.submitUpdate(e)}),500),t.updateSelectedQty=function(e,a){$(document).trigger("cartStartUpdate.ck");var i=$(e).parents("form"),n={};n.category=i.find("input[name=category]").val(),n.model=i.find("input[name=model]").val(),n.name=i.find("input[name=name]").val(),n.slug=i.find("input[name=slug]").val(),n.title=i.find("input[name=title]").val(),n.variation=i.find("input[name=variation]").val()||"",n.currentCount=parseInt(i.find(".qty").val())||0,n.id=i.find(".product_id").val(),n.style=i.find(".style").val(),n.qty=parseInt(a||0),n.mode=$("body").hasClass("purchasing")?"sell-cart":"";var o=i.find("input[name=price_sale]").val()||"";n.price=o.length>0?o:i.find("input[name=price]").val(),n.callback=function(t,e){if(void 0!==e){e=Math.max(0,e);var o=i.parent();i.find(".maxQty").val(e),i.find(".qty").val(e),o.find(".styleQty").text(e),o.find(".qtyList").children().filter((function(t){return t>e})).remove()}var r=parseInt(i.find(".maxQty").val())||0;i.find("input[name=qty]").val(a),a>=r&&i.addClass("maxxed"),t?(n.cart=t,$(document).trigger("updateCart.ck",[n])):$(document).trigger("cartUpdated.ck",[window.ckCatalog.cart()])},t.cartSet(n)},t.getReturnedQty=function(t,e){var a=e[_.findKey(e,(function(e){return e.product_id==t.id&&e.style==t.style}))]||{};return parseInt(a.qty||0)},t.submitUpdate=function(t){var e,a=t.style||"",i=parseInt(t.qty),n="",o="sellcart"===t.mode||$("body").hasClass("purchasing")?"sell-cart":"buy-cart",r={product_id:t.id,style:a,quantity:i};n="sell-cart"===o?"/api/sellcart/add":"/api/cart/add",this.makeRequest(n,"POST",r).then((function(a){try{e=JSON.parse(a.responseText)}catch(e){$(document).trigger("notify.ck",{message:"There was a problem adding &quot;"+t.title+" - "+t.style+"&quot; to the cart. Please refresh the page, and try again.",severity:"error"})}"function"==typeof t.callback&&t.callback(e)}),(function(e){var a,n="There was a problem adding &quot;"+t.title+" - "+t.style+"&quot; to the cart. Please refresh the page, and try again.";if(e&&e.context&&e.context.exception&&"MaxQuantityExceeded"===e.context.exception){var o=e.context.available;void 0!==o&&(a=o,o<=0&&(o=0),n="Couldn't add "+i+" x &quot;"+t.name+"&quot; ("+t.style+") to the cart; amount available has reduced to "+o+".")}$(document).trigger("notify.ck",{message:n,severity:"error"}),"function"==typeof t.callback&&t.callback(void 0,a)}))},t.makeRequest=function(t,e,a){var i=new XMLHttpRequest;return new Promise((function(n,o){i.onreadystatechange=function(){if(4===i.readyState)if(i.status>=200&&i.status<300)n(i);else{var t;try{t=JSON.parse(i.responseText)}catch(e){t=null}o({status:i.status,statusText:i.statusText,context:t})}},i.open(e||"GET",t,!0),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.setRequestHeader("Accept","application/json;charset=UTF-8"),i.send(JSON.stringify(a))}))},t.populateFormQty=function(t){var e=t.hasOwnProperty("fullItems")&&t.fullItems?t.fullItems:t.items;$itemForms=$(".addToCartForm");var a=function(t){var a=e[t];$itemForms.each((function(t,e){a.product_id==$(e).find(".product_id").val()&&a.style===$(e).find(".style").val()&&($(e).find("input[name=qty]").val(a.qty),parseInt(a.qty)>0?(_text='<span class="inCartDesc">'+a.qty+" in Cart</span>",$(e).find(".removeAll").addClass("avail")):($("body").hasClass("purchasing")?_text="<span>Qty to Sell</span>":_text="<span>Add to Cart</span>",$(e).find(".removeAll").removeClass("avail")),$(e).find(".addToCartButton").html(_text))}))};for(var i in e)a(i)}})),(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}var e;window.ckCatalog=window.ckCatalog||{},window.ckCatalog.cart=((e={cartData:{}}).cartData.items={},e.getCart=function(t){var a="sell-cart"===t?"/api/sellcart":"/api/cart";a=a+"?v="+(new Date).getTime().toString(24);var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==this.readyState&&200==this.status){try{cartData=JSON.parse(this.responseText)}catch(t){$(document).trigger("notify.ck",{message:"There was a problem loading your cart. Please refresh the page before adding items to your cart.",severity:"warn"})}e.updateCart(cartData)}},i.open("GET",a,!0),i.send()},e.updateCart=function(a){for(var i=(a.cart||a).lineitems||[],n={},o=0;o<i.length;o++){var r=i[o];r.product_id==a.id&&0==a.qty?(r.touched=!0,r.qty=0):(r.touched=r.product_id==a.id,n[r.id+("string"==typeof r.style&&r.style.length>0?"-"+r.style:"")]=r),void 0!==t(a.qty)&&0===a.qty&&(e.cartData.fullItems=_.map(e.cartData.items,(function(t){return a.id==t.product_id&&(t.touched=!0,t.qty=0),t})))}e.cartData.items=n,$(document).trigger("cartUpdated.ck",[e.cartData]),delete e.cartData.fullItems},$((function(){$(document).on("updateCart.ck",(function(t,a){e.updateCart(a)}));var t=$("body").hasClass("purchasing")?"sell-cart":"buy-cart";e.getCart(t)})),function(){return $.extend(!0,{},e.cartData)})})(),_.templateSettings.interpolate=/{{([\s\S]+?)}}/g,t={},e=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),t.cartType=$("body").hasClass("purchasing")?"sell":"buy",t.buildSideCart=function(e){var a=["game","product"],i=["mtg_card","mtg_foil","mtg_intl"],n="/cart",o="/checkout",r="View Cart";e.productListData={};var s,d=e.items;"sell"!==t.cartType&&(d=_.sortBy(d,(function(t){return[t.title,t.product.model,t.edition,t.name]}))),Object.keys(d).forEach((function(t){if($.inArray(d[t].product.model,a)>=0){var i={};i.id=d[t].product_id||d[t].id,i.qty=d[t].qty,i.name=d[t].name,i.price=parseFloat(d[t].price).toFixed(2),i.style=d[t].style,i.touched=d[t].touched,i.uri=d[t].product.uri,void 0!==d[t].ship_date&&d[t].ship_date.length>1&&(i.ship_date=d[t].ship_date),e.productListData[t]=i}})),e.cardListData={},Object.keys(d).forEach((function(t){if($.inArray(d[t].product.model,i)>=0){var a={};a.id=d[t].product_id||d[t].id,a.model=d[t].product.model,a.qty=d[t].qty,a.name=d[t].title,a.price=parseFloat(d[t].price).toFixed(2),a.style=d[t].style,a.edition=d[t].edition,d[t].variation=d[t].variation,a.touched=d[t].touched,a.uri=d[t].product.uri,void 0!==d[t].ship_date&&d[t].ship_date.length>1&&(a.ship_date=d[t].ship_date),a.qty>0&&(e.cardListData[t]=a)}})),"sell"==t.cartType&&(n="/sellcart",o="/scheckout?dest=/scheckout",r="View Sell Cart"),e.cartlinks='<div class="cartLinks"><a href="'+n+'" data-dd-action-name="Sidecart View Cart">'+r+'</a> | <a href="'+o+'" data-dd-action-name="Sidecart Checkout">Checkout</a></div>',e.subtotal=t.calculateSubTotal(d),e.itemCount="("+t.calculateCount(d)+" items)";var c=t.buildProductListForSideCart(e.productListData);e.productList=c.html,s=c.presales;var l=t.buildCardListForSideCart(e.cardListData);e.cardList=l.html,s=new Set(s.concat(l.presales)),e.hasitems=Object.keys(e.productListData).length>0||Object.keys(e.cardListData).length>0?"hasitems":"",e.presaleHtml=t.buildPresaleHtml(s.size),e.checkoutUrl=o;var u=t.sideCartCompileTemplate({cartData:e});$("#sideCart").html(u)},t.calculateSubTotal=function(t){var a=0;return Object.keys(t).forEach((function(e){a+=parseInt(t[e].qty)*parseFloat(t[e].price)})),e.format(a)},t.calculateCount=function(t){var e=0;return Object.keys(t).forEach((function(a){e+=parseInt(t[a].qty)})),e},t.sideCartCompileTemplate=_.template('<div class="sideCart {{cartData.hasitems}}">        <h5><span class="buyCartTitle">Shopping Cart</span><span class="sellCartTitle">Items I Am Selling</span></h5>        <div class="itemCount">{{cartData.itemCount}}</div>        <div class="subtotal">Subtotal: {{cartData.subtotal}} USD</div>        <div class="processingSpinner sideCartSpinner"></div>        <div class="cartLinks">{{cartData.cartlinks}}</div>        {{cartData.presaleHtml}}        <table class="sideCartList">        {{cartData.productList}}        {{cartData.cardList}}        </table>        <a href="{{cartData.checkoutUrl}}" class="checkoutButton" data-dd-action-name="Secure Checkout"><span class="glyphicon glyphicon-lock"></span><span class="secure">SECURE </span><span>CHECKOUT</span><span class="glyphicon glyphicon-triangle-right"></span></a>    </div>'),t.buildProductListForSideCart=function(a){var i,n,o,r,s,d,c=$("<div></div>"),l=new Set;return Object.keys(a).forEach((function(u){var p=a[u];p.qty>0&&(d=p.ship_date||"",s="",d.length>1&&(s='<div class="preorder"><span class="glyphicon glyphicon-info-sign"></span> Available '+d+'<span class="fullRestrictions"><span class="glyphicon glyphicon-info-sign"></span> <b>Available '+d+"</b><br>This product will be available on "+d+".  <br><b>Please place in-stock items or items released earlier on a separate order if you want them shipped sooner.</b> </span></div>",l.add(d)),n=Number(p.price),n=e.format(n.toFixed(2)),o=p.touched?"touched":"",p.id,r="&nbsp"+(p.style||""),i="sell"==t.cartType?'<tr valign=top class="productDescription '+o+'"><td align=center>'+p.qty+"</td><td align=left>"+p.name+r+s+"</td><td align=right>"+n+"</td></tr>\n":'<tr valign=top class="productDescription '+o+'"><td align=center>'+p.qty+'</td><td align=left><a href="/'+p.uri+'">'+p.name+r+"</a>"+s+"</td><td align=right>"+n+"</td></tr>\n",c.append(i))})),{html:c.html(),presales:Array.from(l)}},t.buildPresaleHtml=function(t){return 1===t?' <div>\n                            <div class="cart-tag">\n                                <div><div class="bold header"><div class="icon"><span>OHN</span></div> <div>Order Hold Notice: Presale Items</div></div></div>\n                                <div>You have at least one presale item in your cart. We will hold your entire order until all items are available. If you would like items shipped sooner, please place separate orders.</div>                            </div>\n                        </div>':t>1?' <div>\n                            <div class="cart-tag">\n                                <div><div class="bold header"><div class="icon"><span>OHN</span></div> <div>Order Hold Notice: Differing Release Dates</div></div></div>\n                                <div>You have presale items in your cart with different release dates. We will hold your order until all items are available. If you would like items shipped sooner, please place separate orders.</div>\n                        </div>':""},t.buildCardListForSideCart=function(a){var n,o,r,s,d,c,l=[],u={},p={},m="",f=$("<div></div>"),h=new Set;for(Object.keys(a).forEach((function(e){var i=a[e];if(i.qty>0){var n="sell"==t.cartType?i.edition:i.name,o=encodeURIComponent(n);void 0===u[o]&&((p={}).name=n,p.items=[],u[o]=p),u[o].items.push(i)}})),Object.keys(u).forEach((function(t){l.push(u[t])})),i=0;i<a.length;i++)if(a[i].qty>0){var v=a[i].name,y=encodeURIComponent(v);void 0===u[y]&&((p={}).name=v,p.items=[],u[y]=p),u[y].items.push(a[i])}return Object.keys(l).forEach((function(a){var u=l[a];o='<tr class="cardTitle"><td colspan="3">'+u.name+"</td></tr>",f.append(o);var p=u.items;for(i=0;i<p.length;i++)if(p[i].qty>0){r=Number(p[i].price),r=e.format(r.toFixed(2)),c=p[i].ship_date||"",d="",c.length>1&&(d='<div class="preorder"> Available '+c+'<span class="fullRestrictions"> <b>Available '+c+"</b><br>This product will be available on "+c+".  <br><b>Please place in-stock items or items released earlier on a separate order if you want them shipped sooner.</b> </span></div>",h.add(c)),n="",s="",p[i].variation&&p[i].variation.length>0&&(s=" - "+p[i].variation),p[i].id,"mtg_foil"===p[i].model&&(n='<span class="foil">FOIL</span>'),m=p[i].touched?"touched":"";var v=void 0;"sell"==t.cartType?v=p[i].name+s:(v=p[i].edition,p[i].style&&(v+=" ("+p[i].style+")")),v+=n,o='<tr valign="top"  class="productDescription '+m+'"><td align=center>'+p[i].qty+'</td><td align=left><a href="/'+p[i].uri+'">'+v+"</a>"+d+"</td><td align=right>"+r+"</td></tr>\n",f.append(o)}})),{html:f.html(),presales:Array.from(h)}},$(document).on("cartStartUpdate.ck",(function(){$("#sideCart .subtotal, #sideCart .itemCount").css({opacity:.1}),setTimeout((function(){parseFloat($("#sideCart .subtotal").css("opacity"))<1&&$("#sideCart .processingSpinner").addClass("activate")}),300)})),$(document).on("cartUpdated.ck",(function(e){t.buildSideCart(window.ckCatalog.cart()),$("#sideCart .subtotal, #sideCart .itemCount").css({opacity:1}),setTimeout((function(){$("#sideCart .processingSpinner").removeClass("activate")}),300)})),function(t){t((function(){var e=0;t(".ckExpand:not(:hidden) input, .ckExpand:not(:hidden) select").each((function(a,i){e++,t(i).attr("tabindex",+e)})),i()}));var e=_.throttle((function(e){var a=t(e.target).parents(".ckExpand");t(e.target).hasClass("ckTooltip")?t(".ckTooltip").css({display:"none"}):t(e.target).hasClass("ckHelp")||a.toggleClass("open")}),300,{leading:!1,trailing:!0}),a=_.throttle((function(e){if(t("body").outerWidth()<=1200){var a=t(window).height()-t(".header").height();t("body #search.sidesearch").css({height:a})}else t("body #search.sidesearch").css({height:"auto"})})),i=function(){t(".includeColors.cardColor input:checked").length>0?t("#colorContainer").addClass("colorIsSet"):(t("#colorContainer").removeClass("colorIsSet"),t(".includeCount input").each((function(e,a){t(a).prop("checked",!1)})))};t(window).on("resize",(function(){a()})),a(),t(document).on("touchend click",'#search.sidesearch .ckExpand:not(".alwaysOpen") .title',(function(t){e(t)})),t(document).on("focus",".ckExpand input, .ckExpand select",(function(e){t(this).parents(".ckExpand").addClass("open")})),t(document).on("touchstart","#search",(function(e){t(e.target).hasClass("ckHelp")||t(".ckTooltip").css({display:"none"})})),t(document).on("click",".sliderTabToggle",(function(){t(this).parent().toggleClass("open")})),t(document).on("click","#sideSearchExpandAll",(function(e){e.preventDefault(),"all"===t(this).data("expand")?(t(".sidesearch .filterHeader.ckExpand:not(.alwaysOpen)").removeClass("open"),t(this).data("expand","").text("Expand All")):(t(".sidesearch .filterHeader.ckExpand").addClass("open"),t(this).data("expand","all").text("Collapse All (-)"))})),t(document).on("input","#filterTypeInput",(function(e){this.value.length>0?t("#filterTypeValue").prop("checked",!0):t("#filterTypeValue").prop("checked",!1)})),t(document).on("change keyup","#search *",(function(e){var a=t(this),i=a.parents(".filterHeader");a.hasClass("editionToggle")||i.hasClass("editionToggle")||a.hasClass("formatToggle")||i.hasClass("formatToggle")?t("#search").submit():(a.addClass("edited"),setTimeout((function(){a.find(".sideSearchApply").css("opacity",1)}),0))})),t(document).on("change",".includeColors input",(function(t){i()}))}(jQuery),$((function(){$(document).on("touchend click",".catalogItem .searchIcon",(function(t){t.preventDefault();var e=$(t.target).parents(".productItemWrapper");e.hasClass("zoomItem")?(e.removeClass("zoomItem"),e.find(".cardLink").removeClass("zoomed")):(e.addClass("zoomItem"),e.find(".cardLink").addClass("zoomed"))}))}))})();
//# sourceMappingURL=catalogView.js.map